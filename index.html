<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Chart Your Progress</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Turret+Road:wght@300;400;700&family=Space+Grotesk:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --dark-blue: #0a192f;
            --light-blue: #ccd6f6;
            --slate-blue: #8892b0;
            --accent-cyan: #64ffda;
            --accent-pink: #ff9a9e;
            --panel-bg: rgba(10, 25, 47, 0.75);
            --border-glow: rgba(100, 255, 218, 0.1);
            --border-color: rgba(100, 255, 218, 0.2);
            --font-header: 'Turret Road', sans-serif;
            --font-body: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background-color: var(--dark-blue); min-height: 100vh; color: var(--light-blue); overflow-x: hidden; }
        #starfield-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .welcome-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--dark-blue); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: opacity 1s ease, visibility 1s ease; }
        .welcome-overlay.hidden { opacity: 0; visibility: hidden; }
        .welcome-content { text-align: center; color: var(--accent-cyan); animation: fadeIn 1.5s ease-out; }
        .welcome-title { font-family: var(--font-header); font-size: 3rem; font-weight: bold; margin-bottom: 20px; text-shadow: 0 0 10px var(--accent-cyan); }
        .motivation-popup { margin-top: 20px; font-size: 1.5rem; font-style: italic; color: var(--light-blue); opacity: 0; animation: fadeIn 1.5s ease-out 1.5s forwards; }
        
        .panel, .stat-card, .info-card, .modal-content, .motivational-quote { background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 15px; box-shadow: 0 0 20px var(--border-glow); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: all 0.3s ease; }
        .panel:hover, .stat-card:hover, .info-card:hover { border-color: var(--accent-cyan); box-shadow: 0 0 25px rgba(100, 255, 218, 0.4); transform: translateY(-3px); }

        .info-card { padding: 25px; animation: fadeInUp 1s ease-out; cursor: pointer; }
        .info-header { display: flex; align-items: center; gap: 15px; color: var(--accent-cyan); font-family: var(--font-header); font-size: 1.5rem; margin-bottom: 10px; }
        .info-header span { font-size: 2rem; filter: drop-shadow(0 0 5px var(--accent-cyan)); transition: transform 0.3s ease; }
        .info-card:hover .info-header span { transform: rotate(15deg); }
        .info-card p { color: var(--slate-blue); line-height: 1.6; margin-left: 45px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 25, 47, 0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; transition: opacity 0.3s ease, visibility 0.3s ease; backdrop-filter: blur(5px); }
        .modal-overlay.hidden { opacity: 0; visibility: hidden; }
        .modal-content { padding: 30px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; animation: slideInUp 0.4s ease-out; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { font-family: var(--font-header); color: var(--accent-cyan); font-size: 1.8rem; }
        .modal-header .close-btn { background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--slate-blue); transition: color 0.2s ease, text-shadow 0.2s ease; }
        .modal-header .close-btn:hover { color: var(--accent-cyan); text-shadow: 0 0 5px var(--accent-cyan); }
        .modal-body h3 { font-family: var(--font-header); color: var(--light-blue); margin-bottom: 10px; }
        .modal-body p { color: var(--slate-blue); line-height: 1.7; margin-bottom: 15px; }
        .modal-body .source { font-style: italic; margin-top: 15px; text-align: right; color: var(--accent-cyan); }
        .lesson-category { margin-bottom: 25px; border-left: 3px solid var(--accent-cyan); padding-left: 20px; }
        .code-snippet { background-color: #01122a; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; font-family: 'Courier New', Courier, monospace; white-space: pre-wrap; color: var(--light-blue); margin: 15px 0; }
        .learn-more-link { display: inline-block; margin-top: 10px; color: var(--accent-cyan); text-decoration: none; border-bottom: 1px solid var(--accent-cyan); transition: all 0.2s ease; }
        .learn-more-link:hover { background-color: rgba(100, 255, 218, 0.1); }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        .header { text-align: center; margin-bottom: 30px; animation: slideDown 0.8s ease-out; }
        .logo { font-family: var(--font-header); font-size: 2.5rem; font-weight: bold; color: var(--accent-cyan); margin-bottom: 10px; text-shadow: 0 0 10px var(--accent-cyan); }
        .tagline { color: var(--light-blue); font-size: 1.2rem; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 25px; text-align: center; animation: fadeInUp 0.6s ease-out; }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: var(--accent-cyan); margin-bottom: 10px; text-shadow: 0 0 5px var(--accent-cyan); }
        .stat-label { color: var(--slate-blue); font-size: 1rem; }

        .main-content { display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; margin-bottom: 30px; }
        .panel { padding: 25px; animation: fadeInUp 0.8s ease-out; }
        .panel h2, .panel h3 { font-family: var(--font-header); color: var(--accent-cyan); margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }

        input[type="text"], select { flex: 1; padding: 12px; background-color: rgba(10, 25, 47, 0.9); border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; color: var(--light-blue); font-family: var(--font-body); transition: border-color 0.3s ease; }
        select option { background: var(--dark-blue); }
        input[type="text"]:focus, select:focus { outline: none; border-color: var(--accent-cyan); }

        .btn { padding: 12px 24px; background: transparent; color: var(--accent-cyan); border: 1px solid var(--accent-cyan); border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: background-color 0.2s ease, box-shadow 0.2s ease; }
        .btn:hover { background-color: rgba(100, 255, 218, 0.1); box-shadow: 0 0 10px rgba(100, 255, 218, 0.3); }

        .task-list { max-height: 400px; overflow-y: auto; }
        .task-item { position: relative; display: flex; align-items: center; justify-content: space-between; padding: 15px; margin-bottom: 10px; background: rgba(10, 25, 47, 0.5); border-radius: 10px; border-left: 4px solid var(--accent-cyan); animation: slideInRight 0.4s ease-out; transition: all 0.3s ease; }
        .task-item:hover { background: rgba(10, 25, 47, 1); transform: translateX(5px); }
        .task-info { flex: 1; display: flex; align-items: center; gap: 15px; }
        .task-name { font-weight: 600; color: var(--light-blue); margin-bottom: 0; }
        .planet-icon { width: 32px; height: 32px; }
        .task-actions { display: flex; gap: 10px; }
        .btn-small { padding: 8px 12px; font-size: 14px; border-radius: 6px; border: none; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 5px; }
        .btn-complete { background: rgba(100, 255, 218, 0.2); color: var(--accent-cyan); }
        .btn-complete:hover { background: rgba(100, 255, 218, 0.4); transform: scale(1.05); }
        .btn-delete { background: rgba(255, 82, 82, 0.2); color: #ff5252; }
        .btn-delete:hover { background: rgba(255, 82, 82, 0.4); transform: scale(1.05); }
        .task-completed { opacity: 0.5; border-left-color: var(--slate-blue); }
        .task-completed .task-name { text-decoration: line-through; }

        .calendar-container { position: relative; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 20px; }
        #constellation-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .constellation-line { stroke: rgba(100, 255, 218, 0.5); stroke-width: 1.5; stroke-dasharray: 4 2; animation: dash 1s linear infinite; }
        
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; position: relative; border: 1px solid transparent; }
        .calendar-day.header { background: transparent; color: var(--accent-cyan); cursor: default; }
        .calendar-day.inactive { background: transparent; border: 1px dashed rgba(136, 146, 176, 0.3); color: var(--slate-blue); }
        .calendar-day.active .day-number { color: white; }
        .calendar-day .day-star { position: absolute; width: 6px; height: 6px; background: var(--accent-cyan); border-radius: 50%; box-shadow: 0 0 8px var(--accent-cyan); animation: pulse-star 1.5s infinite alternate; }
        .calendar-day.perfect-day { background-image: radial-gradient(circle at center, rgba(100, 255, 218, 0.2) 0%, transparent 70%); }
        .calendar-day:not(.header):hover { transform: scale(1.1); border: 1px solid var(--accent-cyan); }

        .progress-bar { width: 100%; height: 10px; background: rgba(136, 146, 176, 0.3); border-radius: 10px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: var(--accent-cyan); border-radius: 10px; transition: width 0.8s ease; position: relative; box-shadow: 0 0 10px var(--accent-cyan); }
        
        .streak-counter { text-align: center; margin: 20px 0; }
        .streak-number { font-size: 3rem; font-weight: bold; color: var(--accent-pink); text-shadow: 0 0 8px var(--accent-pink); }
        .fire-icon { display: inline-block; }
        .fire-icon.active { animation: pulse-fire 1s infinite alternate; }
        
        .motivational-quote { padding: 20px; text-align: center; margin: 20px 0; font-style: italic; color: var(--light-blue); }

        .notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(90deg, #1e3a8a, #3b82f6); color: white; padding: 15px 25px; border-radius: 50px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 10001; opacity: 0; transform: translate(-50%, 100%); transition: opacity 0.5s, transform 0.5s; }
        .notification.show { opacity: 1; transform: translate(-50%, 0); }
        
        #focus-timer-modal .modal-content { text-align: center; }
        .timer-display { position: relative; width: 200px; height: 200px; margin: 20px auto; }
        .timer-ring-bg { fill: none; stroke: var(--border-color); stroke-width: 10; }
        .timer-ring-progress { fill: none; stroke: var(--accent-cyan); stroke-width: 10; stroke-linecap: round; transform: rotate(-90deg); transform-origin: 50% 50%; transition: stroke-dashoffset 1s linear; }
        .timer-text { font-family: var(--font-header); font-size: 2.5rem; color: var(--light-blue); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .timer-mission-name { color: var(--slate-blue); margin-bottom: 20px; }
        .timer-controls button { margin: 0 10px; font-size: 1.5rem; padding: 10px 20px; }

        .time-analysis-container { margin-top: 30px; }
        .category-time-bar { display: flex; align-items: center; margin-bottom: 10px; }
        .category-time-label { width: 100px; text-align: right; margin-right: 10px; color: var(--slate-blue); }
        .category-time-progress { flex-grow: 1; background: rgba(136, 146, 176, 0.3); border-radius: 5px; height: 15px; }
        .category-time-fill { height: 100%; background: var(--accent-cyan); border-radius: 5px; transition: width 0.5s ease; }
        .category-time-value { margin-left: 10px; color: var(--light-blue); }

        .mission-insights-container { margin-top: 30px; }
        .insight-text { color: var(--slate-blue); font-style: italic; padding: 15px; background: rgba(10, 25, 47, 0.5); border-radius: 8px; min-height: 50px; display: flex; align-items: center; justify-content: center; text-align: center; transition: opacity 0.5s ease; }
        .insight-text.fade-out { opacity: 0; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeInUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulse-star { from { transform: scale(1); box-shadow: 0 0 8px var(--accent-cyan); } to { transform: scale(1.4); box-shadow: 0 0 15px var(--accent-cyan); } }
        @keyframes pulse-fire { from { transform: scale(1); filter: drop-shadow(0 0 4px var(--accent-pink)); } to { transform: scale(1.1); filter: drop-shadow(0 0 10px var(--accent-pink)); } }
        @keyframes dash { to { stroke-dashoffset: -6; } }

        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .info-grid { grid-template-columns: 1fr; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>
    <canvas id="starfield-canvas"></canvas>

    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-content">
            <h1 class="welcome-title">Booting Systems...</h1>
            <p class="motivation-popup" id="motivationPopup">"The journey of a thousand miles begins with a single step."</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">🚀 Mission Control</div>
            <div class="tagline">Chart Your Progress</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">Missions Logged</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentStreak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completionRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" id="lessonsTrigger">
                <div class="info-header"><span>📡</span><h3>Daily Briefing</h3></div>
                <p>Decode daily intel on DSA, Web Dev, and Core CSE subjects.</p>
            </div>
            <div class="info-card" id="bookQuoteTrigger">
                <div class="info-header"><span>📚</span><h3>Library</h3></div>
                <p>Access insights from foundational self-help and productivity texts.</p>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>🛰️ Set New Mission</h2>
                <div class="input-group">
                    <input type="text" id="taskInput" placeholder="Enter mission...">
                    <select id="categorySelect">
                        <option value="study">Study</option>
                        <option value="exercise">Exercise</option>
                        <option value="reading">Reading</option>
                        <option value="project">Project</option>
                        <option value="habit">Habit</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <button class="btn" onclick="addTask()">Add Mission</button>
                
                <div class="motivational-quote" id="motivationalQuote">"Per aspera ad astra."</div>
                <h3>📋 Today's Missions</h3>
                <div class="task-list" id="taskList"></div>
            </div>

            <div class="panel">
                <h2>📊 Progress Log</h2>
                <div class="streak-counter">
                    <div><span class="fire-icon" id="fireIcon">🔥</span> Current Streak</div>
                    <div class="streak-number" id="streakDisplay">0</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <h3>🗓️ Star Chart</h3>
                <div class="calendar-container">
                    <div class="calendar-grid" id="calendar"></div>
                    <svg id="constellation-svg"></svg>
                </div>
                <div class="time-analysis-container">
                    <h3>⏱️ Focus Distribution</h3>
                    <div id="timeAnalysis"></div>
                </div>
                <div class="mission-insights-container">
                    <h3>🚀 Mission Insights</h3>
                    <div id="missionInsight" class="insight-text">Calculating...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay hidden" id="lessonsModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📡 Daily Briefing</h2><button class="close-btn" id="closeLessonsModal">&times;</button></div>
            <div class="modal-body" id="lessonsModalBody"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="bookQuoteModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📚 Library</h2><button class="close-btn" id="closeBookQuoteModal">&times;</button></div>
            <div class="modal-body" id="bookQuoteModalBody"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="focus-timer-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>⏱️ Focus Mode Engaged</h2><button class="close-btn" id="closeTimerModal">&times;</button></div>
            <div class="modal-body">
                <h3 class="timer-mission-name" id="timerMissionName"></h3>
                <div class="timer-display">
                    <svg width="200" height="200" viewBox="0 0 120 120">
                        <circle class="timer-ring-bg" cx="60" cy="60" r="54" />
                        <circle class="timer-ring-progress" id="timerRing" cx="60" cy="60" r="54" />
                    </svg>
                    <div class="timer-text" id="timerText">00:00</div>
                </div>
                <div class="timer-controls">
                    <button class="btn" id="timerControlBtn">Pause</button>
                    <button class="btn" id="stopTimerBtn">Stop & Save</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="weeklyReportModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📅 Weekly Mission Report</h2><button class="close-btn" id="closeWeeklyReportModal">&times;</button></div>
            <div class="modal-body" id="weeklyReportBody"></div>
        </div>
    </div>

    <script>
        // --- Planet Icons SVG Definitions ---
        const planetIcons = {
            study: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_study" cx="30%" cy="30%" r="70%"><stop offset="0%" style="stop-color:#FDE68A;stop-opacity:1" /><stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_study)"/><ellipse cx="50" cy="50" rx="48" ry="15" fill="none" stroke="#FDE68A" stroke-width="3" transform="rotate(-20 50 50)"/></svg>`,
            exercise: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_exercise" cx="70%" cy="30%" r="70%"><stop offset="0%" style="stop-color:#FCA5A5;stop-opacity:1" /><stop offset="100%" style="stop-color:#EF4444;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_exercise)"/><circle cx="35" cy="35" r="8" fill="rgba(255,255,255,0.2)"/><circle cx="65" cy="60" r="12" fill="rgba(0,0,0,0.1)"/></svg>`,
            reading: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_reading" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#A7F3D0;stop-opacity:1" /><stop offset="100%" style="stop-color:#34D399;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_reading)"/><path d="M 20,50 C 40,30 60,70 80,50" stroke="rgba(255,255,255,0.4)" stroke-width="5" fill="none"/><path d="M 25,60 C 45,80 65,40 85,60" stroke="rgba(255,255,255,0.3)" stroke-width="4" fill="none"/></svg>`,
            project: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_project" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#93C5FD;stop-opacity:1" /><stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_project)"/><circle cx="45" cy="45" r="2" fill="#FDE68A"/><circle cx="55" cy="55" r="2" fill="#FDE68A"/><circle cx="60" cy="40" r="1" fill="#FDE68A"/></svg>`,
            habit: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_habit" cx="65%" cy="35%" r="65%"><stop offset="0%" style="stop-color:#BFDBFE;stop-opacity:1" /><stop offset="100%" style="stop-color:#60A5FA;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_habit)"/><path d="M 30,30 C 40,60 70,20 70,70" stroke="rgba(255,255,255,0.5)" stroke-width="4" fill="none"/></svg>`,
            other: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_other" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#A78BFA;stop-opacity:1" /><stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" /></radialGradient></defs><path d="M 50 10 L 70 30 L 90 50 L 70 70 L 50 90 L 30 70 L 10 50 L 30 30 Z" fill="url(#grad_other)"/></svg>`
        };

        // --- Daily Content Data ---
        const bookQuotes = [ { title: "Atomic Habits", author: "James Clear", quote: "The most effective way to change your habits is to focus not on what you want to achieve, but on who you wish to become. True behavior change is identity change... Small habits can make a meaningful difference by providing evidence of a new identity." }, { title: "Deep Work", author: "Cal Newport", quote: "Deep work is the ability to focus without distraction on a cognitively demanding task. It’s a skill that allows you to quickly master complicated information and produce better results in less time. The ability to perform deep work is becoming increasingly rare at the same time it is becoming increasingly valuable." }, { title: "The Power of Now", author: "Eckhart Tolle", quote: "Realize deeply that the present moment is all you ever have. Make the NOW the primary focus of your life. All negativity is caused by an accumulation of psychological time and denial of the present. Guilt, regret, resentment... are caused by too much past, and not enough presence." } ];
        const dsaTopics = [ { title: "Binary Search on Answers", content: "A powerful technique where you binary search for the answer itself... It's applicable when you can verify if a potential answer `x` is feasible." }, { title: "Two Pointers Technique", content: "Ideal for problems on sorted arrays or linked lists where you need to find a pair of elements that satisfy a certain condition." } ];
        const webDevTopics = [ { title: "React `useMemo` Hook", content: "Use the `useMemo` hook to memoize expensive calculations, preventing re-computation on every render and optimizing performance." }, { title: "Server-Side Input Validation", content: "Always validate and sanitize user input on the server-side to prevent security vulnerabilities like SQL injection and XSS." } ];
        const cseTopics = [ { title: "Process vs. Thread", content: "A process is an instance of a program with its own memory space, while a thread is the smallest unit of execution within a process, sharing memory." }, { title: "Database Normalization (3NF)", content: "Third Normal Form ensures no non-prime attribute is transitively dependent on the primary key, reducing data redundancy." } ];
        const constellationNames = ["Orion", "Lyra", "Cygnus", "Aquila", "Perseus", "Andromeda", "Cassiopeia", "Draco", "Ursa Major", "Centaurus"];

        // --- Core App State ---
        let tasks = [], completionHistory = {}, timeLog = {}, currentStreak = 0, discoveredStreaks = [];
        let timerInterval = null, timerSeconds = 0, activeTimerTaskId = null;
        
        // --- Dynamic Starfield Canvas ---
        const canvas = document.getElementById('starfield-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let rotation = 0;

        function initStarfield() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars = [];
            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: (Math.random() - 0.5) * canvas.width * 2,
                    y: (Math.random() - 0.5) * canvas.height * 2,
                    z: Math.random() * canvas.width,
                    size: Math.random() * 1.5 + 0.5,
                });
            }
        }

        function animateStarfield() {
            rotation += 0.00005;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(rotation);
            stars.forEach(star => {
                let k = 128 / star.z;
                let px = star.x * k;
                let py = star.y * k;
                let size = (1 - star.z / canvas.width) * star.size;
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 255, 255, ${1 - star.z / canvas.width})`;
                ctx.arc(px, py, size, 0, Math.PI * 2);
                ctx.fill();
                star.z -= 0.2;
                if (star.z <= 0) star.z = canvas.width;
            });
            ctx.restore();
            requestAnimationFrame(animateStarfield);
        }
        
        // --- Modal & UI Logic ---
        function getDayOfYear() { return Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000); }
        function openModal(modalId) {
            const dayIndex = getDayOfYear();
            let content = '';
            if (modalId === 'lessonsModal') {
                const lessons = { dsaLesson: dsaTopics[dayIndex % dsaTopics.length], webDevLesson: webDevTopics[dayIndex % webDevTopics.length], cseLesson: cseTopics[dayIndex % cseTopics.length] };
                content = `<div class="lesson-category"><h3>${lessons.dsaLesson.title} (DSA)</h3><p>${lessons.dsaLesson.content}</p></div><div class="lesson-category"><h3>${lessons.webDevLesson.title} (Web Dev)</h3><p>${lessons.webDevLesson.content}</p></div><div class="lesson-category"><h3>${lessons.cseLesson.title} (Core CSE)</h3><p>${lessons.cseLesson.content}</p></div>`;
                document.getElementById('lessonsModalBody').innerHTML = content;
            } else if (modalId === 'bookQuoteModal') {
                const book = bookQuotes[dayIndex % bookQuotes.length];
                content = `<h3>${book.title}</h3><p>${book.quote}</p><div class="source">- ${book.author}</div>`;
                document.getElementById('bookQuoteModalBody').innerHTML = content;
            }
            document.getElementById(modalId).classList.remove('hidden');
        }
        function closeModal(modalId) { document.getElementById(modalId).classList.add('hidden'); }

        function showNotification(message) {
            let notification = document.querySelector('.notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.className = 'notification';
                document.body.appendChild(notification);
            }
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => { notification.classList.remove('show'); }, 4000);
        }

        function init() {
            setTimeout(() => { document.getElementById('welcomeOverlay').classList.add('hidden'); }, 4000);
            initStarfield();
            animateStarfield();
            loadData(); updateStats(); renderTasks(); renderCalendar(); renderTimeAnalysis();
            
            document.getElementById('lessonsTrigger').addEventListener('click', () => openModal('lessonsModal'));
            document.getElementById('closeLessonsModal').addEventListener('click', () => closeModal('lessonsModal'));
            document.getElementById('lessonsModal').addEventListener('click', (e) => { if (e.target.id === 'lessonsModal') closeModal('lessonsModal'); });

            document.getElementById('bookQuoteTrigger').addEventListener('click', () => openModal('bookQuoteModal'));
            document.getElementById('closeBookQuoteModal').addEventListener('click', () => closeModal('bookQuoteModal'));
            document.getElementById('bookQuoteModal').addEventListener('click', (e) => { if (e.target.id === 'bookQuoteModal') closeModal('bookQuoteModal'); });
            
            document.getElementById('closeTimerModal').addEventListener('click', stopTimer);
            document.getElementById('timerControlBtn').addEventListener('click', toggleTimer);
            document.getElementById('stopTimerBtn').addEventListener('click', stopTimer);
        }

        // --- Core App Logic ---
        function addTask() {
            const taskInput = document.getElementById('taskInput');
            const categorySelect = document.getElementById('categorySelect');
            if (!taskInput.value.trim()) return;
            const task = { id: Date.now(), name: taskInput.value.trim(), category: categorySelect.value, completed: false, timeSpent: 0, createdAt: new Date().toDateString() };
            tasks.push(task);
            taskInput.value = '';
            renderTasks(); updateStats(); saveData();
        }

        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                const today = new Date().toDateString();
                const todayTasks = tasks.filter(t => t.createdAt === today);
                const allComplete = todayTasks.every(t => t.completed);
                if (todayTasks.some(t => t.completed)) {
                    completionHistory[today] = { completed: true, perfect: allComplete };
                } else {
                    delete completionHistory[today];
                }
                renderTasks(); updateStats(); renderCalendar(); saveData();
            }
        }

        function deleteTask(taskId) { tasks = tasks.filter(t => t.id !== taskId); renderTasks(); updateStats(); saveData(); }

        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const todayTasks = tasks.filter(t => t.createdAt === new Date().toDateString());
            taskList.innerHTML = todayTasks.map(task => `
                <div class="task-item ${task.completed ? 'task-completed' : ''}">
                    <div class="task-info">
                        ${planetIcons[task.category] || planetIcons['other']}
                        <span class="task-name">${task.name}</span>
                    </div>
                    <div class="task-actions">
                        <button class="btn-small btn-complete" onclick="startTimer(${task.id})">Engage</button>
                        <button class="btn-small btn-complete" onclick="completeTask(${task.id})">${task.completed ? 'Done' : 'Complete'}</button>
                        <button class="btn-small btn-delete" onclick="deleteTask(${task.id})">Delete</button>
                    </div>
                </div>`).join('');
        }

        function updateStats() {
            const todayTasks = tasks.filter(t => t.createdAt === new Date().toDateString());
            const completedToday = todayTasks.filter(t => t.completed).length;
            const totalToday = todayTasks.length;
            const completionRate = totalToday > 0 ? Math.round((completedToday / totalToday) * 100) : 0;
            
            calculateStreak();

            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('completedTasks').textContent = completedToday;
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('completionRate').textContent = completionRate + '%';
            document.getElementById('streakDisplay').textContent = currentStreak;
            document.getElementById('progressFill').style.width = completionRate + '%';
            
            const fireIcon = document.getElementById('fireIcon');
            if (currentStreak > 0) { fireIcon.classList.add('active'); } else { fireIcon.classList.remove('active'); }
        }

        function calculateStreak() {
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                if (completionHistory[date.toDateString()]?.completed) streak++;
                else break;
            }
            
            const milestones = [3, 5, 7, 14, 30];
            if (milestones.includes(streak) && !discoveredStreaks.includes(streak)) {
                const constellationIndex = milestones.indexOf(streak);
                const constellationName = constellationNames[constellationIndex % constellationNames.length];
                showNotification(`🌟 Constellation Discovered: ${constellationName}! (${streak}-Day Streak)`);
                discoveredStreaks.push(streak);
            }
            currentStreak = streak;
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            let calendarHTML = days.map(day => `<div class="calendar-day header">${day}</div>`).join('');
            for (let i = 0; i < firstDay.getDay(); i++) calendarHTML += '<div></div>';
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(today.getFullYear(), today.getMonth(), day);
                const dateStr = date.toDateString();
                const history = completionHistory[dateStr];
                let className = 'calendar-day';
                let content = `<span class="day-number">${day}</span>`;
                
                if (history?.completed) {
                    className += ' active';
                    content += `<div class="day-star" data-date="${dateStr}"></div>`;
                }
                if (history?.perfect) className += ' perfect-day';
                if (!history?.completed && date < today) className += ' inactive';
                
                calendarHTML += `<div class="${className}" data-date="${dateStr}">${content}</div>`;
            }
            calendar.innerHTML = calendarHTML;
            setTimeout(drawConstellations, 0);
        }

        function drawConstellations() {
            const svg = document.getElementById('constellation-svg');
            const calendarRect = document.getElementById('calendar').getBoundingClientRect();
            if (!svg || !calendarRect.width) return;
            svg.innerHTML = ''; 
            
            const activeDays = Object.keys(completionHistory).filter(d => completionHistory[d].completed).map(d => new Date(d)).sort((a, b) => a - b);
            
            for (let i = 0; i < activeDays.length - 1; i++) {
                const day1 = activeDays[i];
                const day2 = activeDays[i+1];
                
                if ((day2 - day1) / 86400000 === 1) {
                    const el1 = document.querySelector(`.calendar-day[data-date="${day1.toDateString()}"]`);
                    const el2 = document.querySelector(`.calendar-day[data-date="${day2.toDateString()}"]`);
                    
                    if (el1 && el2) {
                        const rect1 = el1.getBoundingClientRect();
                        const rect2 = el2.getBoundingClientRect();
                        
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', rect1.left - calendarRect.left + rect1.width / 2);
                        line.setAttribute('y1', rect1.top - calendarRect.top + rect1.height / 2);
                        line.setAttribute('x2', rect2.left - calendarRect.left + rect2.width / 2);
                        line.setAttribute('y2', rect2.top - calendarRect.top + rect2.height / 2);
                        line.setAttribute('class', 'constellation-line');
                        svg.appendChild(line);
                    }
                }
            }
        }

        // --- Timer Logic ---
        function startTimer(taskId) {
            if (timerInterval) clearInterval(timerInterval);
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            activeTimerTaskId = taskId;
            timerSeconds = task.timeSpent || 0;
            document.getElementById('timerMissionName').textContent = task.name;
            openModal('focus-timer-modal');
            timerInterval = setInterval(updateTimer, 1000);
            document.getElementById('timerControlBtn').textContent = 'Pause';
        }

        function updateTimer() {
            timerSeconds++;
            const minutes = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const seconds = (timerSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timerText').textContent = `${minutes}:${seconds}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('timerControlBtn');
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                btn.textContent = 'Resume';
            } else {
                timerInterval = setInterval(updateTimer, 1000);
                btn.textContent = 'Pause';
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            const task = tasks.find(t => t.id === activeTimerTaskId);
            if (task) {
                task.timeSpent = timerSeconds;
                const today = new Date().toDateString();
                if (!timeLog[today]) timeLog[today] = {};
                if (!timeLog[today][task.category]) timeLog[today][task.category] = 0;
                timeLog[today][task.category] = (timeLog[today][task.category] || 0) + timerSeconds - (task.timeSpent - timerSeconds); // This logic needs review
            }
            activeTimerTaskId = null;
            timerSeconds = 0;
            closeModal('focus-timer-modal');
            renderTimeAnalysis();
            saveData();
        }

        function renderTimeAnalysis() {
            const today = new Date().toDateString();
            const analysisContainer = document.getElementById('timeAnalysis');
            const dailyLog = timeLog[today] || {};
            let totalTime = 0;
            Object.values(dailyLog).forEach(time => totalTime += time);

            if (totalTime === 0) {
                analysisContainer.innerHTML = `<p style="color: var(--slate-blue);">No focus time logged today.</p>`;
                return;
            }

            let html = '';
            for (const category in dailyLog) {
                const time = dailyLog[category];
                const percentage = (time / totalTime) * 100;
                const minutes = Math.floor(time / 60);
                const seconds = time % 60;
                html += `
                    <div class="category-time-bar">
                        <div class="category-time-label">${category}</div>
                        <div class="category-time-progress">
                            <div class="category-time-fill" style="width: ${percentage}%;"></div>
                        </div>
                        <div class="category-time-value">${minutes}m ${seconds}s</div>
                    </div>
                `;
            }
            analysisContainer.innerHTML = html;
        }

        // --- Data Persistence ---
        function saveData() {
            try {
                localStorage.setItem('mission_control_data_v5', JSON.stringify({ tasks, completionHistory, discoveredStreaks, timeLog }));
            } catch (error) { console.error('Failed to save data:', error); }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('mission_control_data_v5');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    tasks = data.tasks || [];
                    completionHistory = data.completionHistory || {};
                    discoveredStreaks = data.discoveredStreaks || [];
                    timeLog = data.timeLog || {};
                }
            } catch (error) { console.error('Failed to load data:', error); }
        }

        window.addEventListener('load', init);
        window.addEventListener('resize', () => { initStarfield(); renderCalendar(); });
    </script>
</body>
</html>
