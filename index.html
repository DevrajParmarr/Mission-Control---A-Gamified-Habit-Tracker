<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discipline Yourself Buddy</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Turret+Road:wght@300;400;700&family=Space+Grotesk:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Orbitron:wght@500&display=swap" rel="stylesheet">

    <!-- Prism.js for Code Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>

    <!-- Chart.js for Analytics Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

     <style>
     
     /* Core Reset and Variables */
:root {
    --space-black: #0b1120; /* Deep cosmic black */
    --nebula-blue: #1e3a8a; /* Vibrant blue for gradients */
    --star-white: #f1f5f9; /* Soft white for text */
    --glow-cyan: #22d3ee; /* Bright cyan for accents */
    --glow-purple: #c084fc; /* Purple for secondary accents */
    --panel-bg: rgba(20, 30, 60, 0.9); /* Semi-transparent panel with depth */
    --border-glow: rgba(34, 211, 238, 0.4); /* Subtle glowing border */
    --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; /* Clean body font */
    --font-heading: 'Orbitron', sans-serif; /* Futuristic heading font */
}

[data-theme="light"] {
    --space-black: #e5e7eb; /* Light gray for light mode */
    --star-white: #1e293b; /* Dark text for contrast */
    --panel-bg: rgba(255, 255, 255, 0.95); /* Clean white panel */
    --border-glow: rgba(0, 0, 0, 0.15); /* Subtle border */
    --glow-cyan: #0ea5e9; /* Darker cyan for light mode */
    --glow-purple: #a855f7; /* Darker purple for light mode */
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-primary);
    background: linear-gradient(180deg, var(--space-black), var(--nebula-blue));
    color: var(--star-white);
    min-height: 100vh;
    line-height: 1.6;
    transition: background 0.5s ease, color 0.5s ease;
}

/* Starfield Canvas */
#starfield-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    display: block;
}

[data-theme="light"] #starfield-canvas {
    display: none;
}

/* Welcome Overlay */
.welcome-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--space-black), var(--nebula-blue));
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.8s ease;
}

.welcome-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

.welcome-title {
    font-family: var(--font-heading);
    font-size: 3rem;
    color: var(--glow-cyan);
    text-shadow: 0 0 10px var(--glow-cyan);
    margin-bottom: 1rem;
    animation: glowPulse 2s ease-in-out infinite;
}

.motivation-popup {
    font-size: 1.5rem;
    font-style: italic;
    color: var(--star-white);
    opacity: 0;
    animation: fadeIn 1.2s ease-out 0.8s forwards;
}

/* Container and Header */
.container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 2rem;
}

.header {
    text-align: center;
    margin-bottom: 2.5rem;
    animation: slideInDown 0.8s ease-out;
}

.logo {
    font-family: var(--font-heading);
    font-size: 2.5rem;
    color: var(--glow-cyan);
    text-shadow: 0 0 8px var(--glow-cyan);
    margin-bottom: 0.5rem;
}

.tagline {
    font-size: 1.1rem;
    color: var(--star-white);
    opacity: 0.85;
}

.level-display {
    font-size: 1rem;
    color: var(--glow-purple);
    font-weight: 500;
}



/* Theme Toggle */
.theme-toggle {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    background: none;
    border: none;
    font-size: 1.75rem;
    color: var(--glow-cyan);
    cursor: pointer;
    transition: transform 0.3s ease, text-shadow 0.3s ease;
}

.theme-toggle:hover {
    transform: rotate(360deg);
    text-shadow: 0 0 10px var(--glow-cyan);
}

/* Panels and Cards */
.panel, .stat-card, .info-card, .modal-content, .motivational-quote {
    background: var(--panel-bg);
    border: 1px solid var(--border-glow);
    border-radius: 0.75rem;
    padding: 1.75rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.panel:hover, .stat-card:hover, .info-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(34, 211, 238, 0.3);
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
}

.info-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-family: var(--font-heading);
    font-size: 1.4rem;
    color: var(--glow-cyan);
    margin-bottom: 0.75rem;
}

.info-header span {
    font-size: 1.75rem;
    transition: transform 0.3s ease;
}

.info-card:hover .info-header span {
    transform: scale(1.2);
}

.info-card p {
    font-size: 0.95rem;
    color: var(--star-white);
    opacity: 0.9;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
}

.stat-card {
    text-align: center;
}

.stat-number {
    font-size: 2.25rem;
    font-weight: bold;
    color: var(--glow-cyan);
    text-shadow: 0 0 5px var(--glow-cyan);
}

.stat-label {
    font-size: 0.95rem;
    color: var(--star-white);
    opacity: 0.85;
}

/* Main Content */
.main-content {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 2rem;
}

.panel h2 {
    font-family: var(--font-heading);
    font-size: 1.75rem;
    color: var(--glow-cyan);
    margin-bottom: 1.25rem;
}

/* Input Group */
.input-group {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
}

input[type="text"], select {
    padding: 0.85rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border-glow);
    border-radius: 0.5rem;
    color: var(--star-white);
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

[data-theme="light"] input[type="text"], [data-theme="light"] select {
    background: #fff;
    border-color: #d1d5db;
    color: var(--star-white);
}

input[type="text"]:focus, select:focus {
    outline: none;
    border-color: var(--glow-cyan);
    box-shadow: 0 0 8px var(--glow-cyan);
}

.btn {
    padding: 0.85rem 1.75rem;
    background: linear-gradient(90deg, var(--glow-cyan), var(--glow-purple));
    color: var(--space-black);
    border: none;
    border-radius: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 12px var(--glow-cyan);
}

/* Task List */
.task-list {
    max-height: 350px;
    overflow-y: auto;
    padding-right: 0.5rem;
}

.task-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    margin-bottom: 0.75rem;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.1));
    border-radius: 0.5rem;
    border-left: 4px solid var(--glow-cyan);
    transition: transform 0.3s ease, background 0.3s ease;
}

.task-item:hover {
    transform: translateX(5px);
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.15));
}

.task-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.task-name {
    font-weight: 600;
    color: var(--star-white);
}

.priority-label {
    font-size: 0.8rem;
    padding: 0.3rem 0.75rem;
    border-radius: 1rem;
    color: #fff;
    font-weight: 500;
}

.priority-high { background: #f87171; }
.priority-medium { background: #fb923c; }
.priority-low { background: #34d399; }

.planet-icon {
    width: 28px;
    height: 28px;
}

.btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    background: rgba(255, 255, 255, 0.15);
    color: var(--glow-cyan);
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.3s ease;
}

.btn-small:hover {
    background: var(--glow-cyan);
    color: var(--space-black);
    transform: scale(1.05);
}

.task-completed {
    opacity: 0.7;
    border-left-color: var(--glow-purple);
}

.task-completed .task-name {
    text-decoration: line-through;
}

/* Calendar */
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
    margin-top: 1.5rem;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 500;
    border-radius: 0.5rem;
    transition: background 0.3s ease, transform 0.3s ease;
}

.calendar-day.header {
    font-weight: bold;
    color: var(--glow-cyan);
}

.calendar-day.inactive {
    color: var(--star-white);
    opacity: 0.6;
}

.calendar-day.active {
    background: rgba(34, 211, 238, 0.2);
}

.calendar-day.perfect-day {
    background: rgba(192, 132, 252, 0.3);
    box-shadow: 0 0 10px var(--glow-purple);
}

.calendar-day .day-star {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--glow-cyan);
    border-radius: 50%;
    animation: starPulse 1.5s ease-in-out infinite;
}

.constellation-line {
    stroke: var(--glow-cyan);
    stroke-width: 1.5;
    stroke-dasharray: 3 3;
    animation: dash 2s linear infinite;
}

/* Progress Bar */
.progress-bar {
    height: 10px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 2rem;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--glow-cyan), var(--glow-purple));
    border-radius: 2rem;
    transition: width 0.6s ease;
    box-shadow: 0 0 10px var(--glow-cyan);
}

/* Streak Counter */
.streak-counter {
    text-align: center;
    margin: 1.5rem 0;
}

.streak-number {
    font-size: 3rem;
    font-weight: bold;
    color: var(--glow-purple);
    text-shadow: 0 0 8px var(--glow-purple);
}

.fire-icon.active {
    animation: firePulse 1s ease-in-out infinite;
}

/* Motivational Quote */
.motivational-quote {
    font-style: italic;
    text-align: center;
    padding: 1.25rem;
    color: var(--star-white);
    background: linear-gradient(90deg, rgba(34, 211, 238, 0.1), rgba(192, 132, 252, 0.1));
    border-radius: 0.5rem;
}

/* Modals */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: opacity 0.4s ease;
}

.modal-overlay.hidden {
    opacity: 0;
    pointer-events: none;
}

.modal-content {
    max-width: 700px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    animation: slideInUp 0.4s ease-out;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-glow);
    padding-bottom: 0.75rem;
}

.modal-header h2 {
    font-family: var(--font-heading);
    font-size: 1.75rem;
    color: var(--glow-cyan);
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.75rem;
    color: var(--star-white);
    cursor: pointer;
    transition: color 0.3s ease, transform 0.3s ease;
}

.close-btn:hover {
    color: var(--glow-cyan);
    transform: scale(1.2);
}

.modal-body p {
    margin-bottom: 1rem;
    color: var(--star-white);
    font-size: 1rem;
}

.code-snippet {
    background: rgba(0, 0, 0, 0.4);
    padding: 1.25rem;
    border-radius: 0.5rem;
    margin: 1rem 0;
    font-family: 'Courier New', monospace;
    color: var(--star-white);
}

.learn-more-link {
    color: var(--glow-cyan);
    text-decoration: none;
    font-weight: 500;
}

.learn-more-link:hover {
    text-decoration: underline;
    color: var(--glow-purple);
}

/* Timer Modal */
#focus-timer-modal .modal-content {
    text-align: center;
    background: linear-gradient(135deg, var(--panel-bg), rgba(34, 211, 238, 0.1));
    border: 2px solid var(--glow-cyan);
    box-shadow: 0 0 20px var(--glow-cyan);
    animation: modalGlow 2s ease-in-out infinite;
}

.timer-display {
    width: 200px;
    height: 200px;
    margin: 2rem auto;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.timer-ring-bg {
    fill: none;
    stroke: var(--border-glow);
    stroke-width: 8;
}

.timer-ring-progress {
    fill: none;
    stroke: var(--glow-cyan);
    stroke-width: 8;
    stroke-linecap: round;
    animation: ringPulse 2s ease-in-out infinite;
}

.timer-text {
    position: absolute;
    font-family: var(--font-heading);
    font-size: 2.5rem;
    color: var(--star-white);
    text-shadow: 0 0 8px var(--glow-cyan);
    animation: textGlow 1.5s ease-in-out infinite;
}

.timer-mission-name {
    color: var(--glow-purple);
    font-family: var(--font-heading);
    font-size: 1.25rem;
    margin-bottom: 1.5rem;
}

.timer-controls button {
    margin: 0 0.75rem;
}

/* Time Analysis */
.category-time-bar {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
}

.category-time-label {
    width: 100px;
    text-align: right;
    margin-right: 0.75rem;
    font-size: 0.9rem;
    color: var(--star-white);
}

.category-time-progress {
    flex-grow: 1;
    height: 12px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 2rem;
}

.category-time-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--glow-cyan), var(--glow-purple));
    border-radius: 2rem;
    transition: width 0.5s ease;
}

.category-time-value {
    margin-left: 0.75rem;
    font-size: 0.9rem;
}

/* Quiz */
.quiz-question {
    font-size: 1.2rem;
    margin-bottom: 1.25rem;
    color: var(--star-white);
}

.quiz-options {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.quiz-option {
    padding: 0.85rem;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 0.5rem;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.3s ease;
}

.quiz-option:hover {
    background: rgba(34, 211, 238, 0.3);
    transform: translateX(3px);
}

.quiz-option.correct {
    background: rgba(34, 211, 238, 0.5);
}

.quiz-option.incorrect {
    background: rgba(248, 113, 113, 0.5);
}

.quiz-feedback {
    margin-top: 0.75rem;
    font-style: italic;
    color: var(--star-white);
}

/* Achievements */
.achievement-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.1));
    border-radius: 0.5rem;
    margin-bottom: 0.75rem;
    border-left: 4px solid var(--glow-purple);
}

.achievement-icon {
    font-size: 1.5rem;
}

.achievement-name {
    font-weight: 600;
    color: var(--star-white);
}

.achievement-desc {
    font-size: 0.9rem;
    color: var(--star-white);
    opacity: 0.85;
}

/* Notification */
.notification {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg, var(--glow-cyan), var(--glow-purple));
    color: var(--space-black);
    padding: 0.85rem 2rem;
    border-radius: 2rem;
    z-index: 1001;
    opacity: 0;
    transform: translate(-50%, 20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
}

.notification.show {
    opacity: 1;
    transform: translate(-50%, 0);
}

/* Loading Spinner */
.loading-spinner {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 4px solid var(--glow-cyan);
    border-top: 4px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 1002;
}

.loading-spinner.show {
    display: block;
}


.timeAnalysisContainer {
   padding-top: 50%;
    margin-top: 100 px;
    text-align: center;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes slideInUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes glowPulse {
    0% { text-shadow: 0 0 5px var(--glow-cyan); }
    50% { text-shadow: 0 0 15px var(--glow-cyan); }
    100% { text-shadow: 0 0 5px var(--glow-cyan); }
}

@keyframes starPulse {
    0% { transform: scale(1); box-shadow: 0 0 5px var(--glow-cyan); }
    50% { transform: scale(1.3); box-shadow: 0 0 10px var(--glow-cyan); }
    100% { transform: scale(1); box-shadow: 0 0 5px var(--glow-cyan); }
}

@keyframes firePulse {
    0% { transform: scale(1); text-shadow: 0 0 5px var(--glow-purple); }
    50% { transform: scale(1.2); text-shadow: 0 0 10px var(--glow-purple); }
    100% { transform: scale(1); text-shadow: 0 0 5px var(--glow-purple); }
}

@keyframes dash {
    to { stroke-dashoffset: -6; }
}

@keyframes modalGlow {
    0% { box-shadow: 0 0 10px var(--glow-cyan); }
    50% { box-shadow: 0 0 20px var(--glow-cyan); }
    100% { box-shadow: 0 0 10px var(--glow-cyan); }
}

@keyframes ringPulse {
    0% { stroke: var(--glow-cyan); }
    50% { stroke: #67e8f9; }
    100% { stroke: var(--glow-cyan); }
}

@keyframes textGlow {
    0% { text-shadow: 0 0 5px var(--glow-cyan); }
    50% { text-shadow: 0 0 12px var(--glow-cyan); }
    100% { text-shadow: 0 0 5px var(--glow-cyan); }
}

@keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

@media (max-width: 768px) {
    .main-content {
        grid-template-columns: 1fr;
    }

    .info-grid, .stats-grid {
        grid-template-columns: 1fr;
    }

    .modal-content {
        width: 95%;
    }

    .welcome-title {
        font-size: 2rem;
    }

    .motivation-popup {
        font-size: 1.25rem;
    }

    .timer-display {
        width: 150px;
        height: 150px;
    }

    .timer-text {
        font-size: 2rem;
    }
}</style>
</head>
<body data-theme="dark">
    <canvas id="starfield-canvas"></canvas>
    <div class="loading-spinner" id="loadingSpinner"></div>

    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-content">
            <h1 class="welcome-title">DISCIPLINE: WORTH IT...</h1>
            <p class="motivation-popup" id="motivationPopup">"The journey of a thousand miles begins with a single step."</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <button class="theme-toggle" id="themeToggle">🌙</button>
            <div class="logo">🚀 Mission Control</div>
            <div class="tagline">Take Control in your Hand</div>
            <div class="level-display" id="levelDisplay">Level: 1</div>

            
            <div class="time-analysis-container id="timeAnalysisContainer" >
                    <h3>⏱️ YOUR FOCUS DISTRIBUTION</h3>
                    <div id="timeAnalysis"></div>
                </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">Missions Logged</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentStreak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completionRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" id="lessonsTrigger">
                <div class="info-header"><span>📡</span><h3>Daily Briefing</h3></div>
                <p>Decode daily intel on DSA, Web Dev, and Core CSE with quizzes.</p>
            </div>
            <div class="info-card" id="bookQuoteTrigger">
                <div class="info-header"><span>📚</span><h3>Library</h3></div>
                <p>Access insights from foundational self-help and productivity texts.</p>
            </div>
            <div class="info-card" id="constellationTrigger">
                <div class="info-header"><span>🌌</span><h3>Constellation Guide</h3></div>
                <p>Discover daily constellations to spark conversation and inspiration.</p>
            </div>
            <div class="info-card" id="achievementsTrigger">
                <div class="info-header"><span>🏆</span><h3>Achievements</h3></div>
                <p>View your earned badges and milestones!</p>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>🛰️ Set New Mission</h2>
                <div class="input-group">
                    <input type="text" id="taskInput" placeholder="Enter mission...">
                    <select id="categorySelect">
                       
                        <option value="DSA">DSA</option>
                        <option value="Development">Development</option>
                        <option value="project">Project</option>

                        <option value="other">Other</option>
                    </select>
                    <select id="prioritySelect">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <button class="btn" onclick="addTask()">Add Mission</button>
                
                <div class="motivational-quote" id="motivationalQuote">"ReBuild it ..BRICK BY BRICK "</div>
                <h3>📋 Today's Missions</h3>
                <div class="task-list" id="taskList"></div>
            </div>

            <div class="panel">

              
                <h2>📊 Progress Log</h2>
                <div class="streak-counter">
                    <div><span class="fire-icon" id="fireIcon">🔥</span> Current Streak</div>
                    <div class="streak-number" id="streakDisplay">0</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <h3>🗓️ Star Chart</h3>
                <div class="calendar-container">
                    <div class="calendar-grid" id="calendar"></div>
                    <svg id="constellation-svg"></svg>
                </div>
               
                <div class="mission-insights-container">
                    <h3>🚀 Mission Insights</h3>
                    <div id="missionInsight" class="insight-text">Calculating...</div>
                </div>
                <button class="btn" id="weeklyReportTrigger">Weekly Report</button>
                <button class="btn" id="analyticsTrigger">Analytics Dashboard</button>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <div class="modal-overlay hidden" id="focus-timer-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>⏱️ Focus Mode Engaged</h2><button class="close-btn" id="closeTimerModal">&times;</button></div>
            <div class="modal-body">
                <h3 class="timer-mission-name" id="timerMissionName"></h3>
                <div class="timer-display">
                    <svg width="200" height="200" viewBox="0 0 120 120">
                        <circle class="timer-ring-bg" cx="60" cy="60" r="54" />
                        <circle class="timer-ring-progress" id="timerRing" cx="60" cy="60" r="54" stroke-dasharray="339.292" stroke-dashoffset="339.292" />
                    </svg>
                    <div class="timer-text" id="timerText">00:00</div>
                </div>
                <div class="timer-controls">
                    <button class="btn" id="timerControlBtn">Pause</button>
                    <button class="btn" id="stopTimerBtn">Stop & Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay hidden" id="lessonsModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📡 Daily Briefing</h2><button class="close-btn" id="closeLessonsModal">&times;</button></div>
            <div class="modal-body" id="lessonsModalBody"></div>
            <div class="quiz-container" id="quizContainer"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="bookQuoteModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📚 Library</h2><button class="close-btn" id="closeBookQuoteModal">&times;</button></div>
            <div class="modal-body" id="bookQuoteModalBody"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="constellationModal">
        <div class="modal-content">
            <div class="modal-header"><h2>🌌 Constellation Guide</h2><button class="close-btn" id="closeConstellationModal">&times;</button></div>
            <div class="modal-body" id="constellationModalBody"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="focus-timer-modal">
        <div class="modal-content">
            <div class="modal-header"><h2>⏱️ Focus Mode Engaged</h2><button class="close-btn" id="closeTimerModal">&times;</button></div>
            <div class="modal-body">
                <h3 class="timer-mission-name" id="timerMissionName"></h3>
                <div class="timer-display">
                    <svg width="200" height="200" viewBox="0 0 120 120">
                        <circle class="timer-ring-bg" cx="60" cy="60" r="54" />
                        <circle class="timer-ring-progress" id="timerRing" cx="60" cy="60" r="54" stroke-dasharray="339.292" stroke-dashoffset="339.292" />
                    </svg>
                    <div class="timer-text" id="timerText">00:00</div>
                </div>
                <div class="timer-controls">
                    <button class="btn" id="timerControlBtn">Pause</button>
                    <button class="btn" id="stopTimerBtn">Stop & Save</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="weeklyReportModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📅 Weekly Mission Report</h2><button class="close-btn" id="closeWeeklyReportModal">&times;</button></div>
            <div class="modal-body" id="weeklyReportBody"></div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="analyticsModal">
        <div class="modal-content">
            <div class="modal-header"><h2>📊 Analytics Dashboard</h2><button class="close-btn" id="closeAnalyticsModal">&times;</button></div>
            <div class="modal-body">
                <canvas id="completionChart" style="max-height: 300px; margin-bottom: 20px;"></canvas>
                <canvas id="categoryChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
    <div class="modal-overlay hidden" id="achievementsModal">
        <div class="modal-content">
            <div class="modal-header"><h2>🏆 Achievements</h2><button class="close-btn" id="closeAchievementsModal">&times;</button></div>
            <div class="modal-body" id="achievementsModalBody"></div>
        </div>
    </div>

    <script>
        // --- Planet Icons SVG Definitions ---
        const planetIcons = {
            study: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_study" cx="30%" cy="30%" r="70%"><stop offset="0%" style="stop-color:#FDE68A;stop-opacity:1" /><stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_study)"/><ellipse cx="50" cy="50" rx="48" ry="15" fill="none" stroke="#FDE68A" stroke-width="3" transform="rotate(-20 50 50)"/></svg>`,
            DSA: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_dsa" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#A7F3D0;stop-opacity:1" /><stop offset="100%" style="stop-color:#34D399;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_dsa)"/><path d="M 20,50 C 40,30 60,70 80,50" stroke="rgba(255,255,255,0.4)" stroke-width="5" fill="none"/><path d="M 25,60 C 45,80 65,40 85,60" stroke="rgba(255,255,255,0.3)" stroke-width="4" fill="none"/></svg>`,
            Development: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_development" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#93C5FD;stop-opacity:1" /><stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_development)"/><circle cx="45" cy="45" r="2" fill="#FDE68A"/><circle cx="55" cy="55" r="2" fill="#FDE68A"/><circle cx="60" cy="40" r="1" fill="#FDE68A"/></svg>`,
            project: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_project" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#93C5FD;stop-opacity:1" /><stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_project)"/><circle cx="45" cy="45" r="2" fill="#FDE68A"/><circle cx="55" cy="55" r="2" fill="#FDE68A"/><circle cx="60" cy="40" r="1" fill="#FDE68A"/></svg>`,
            habit: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_habit" cx="65%" cy="35%" r="65%"><stop offset="0%" style="stop-color:#BFDBFE;stop-opacity:1" /><stop offset="100%" style="stop-color:#60A5FA;stop-opacity:1" /></radialGradient></defs><circle cx="50" cy="50" r="40" fill="url(#grad_habit)"/><path d="M 30,30 C 40,60 70,20 70,70" stroke="rgba(255,255,255,0.5)" stroke-width="4" fill="none"/></svg>`,
            other: `<svg class="planet-icon" viewBox="0 0 100 100"><defs><radialGradient id="grad_other" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#A78BFA;stop-opacity:1" /><stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" /></radialGradient></defs><path d="M 50 10 L 70 30 L 90 50 L 70 70 L 50 90 L 30 70 L 10 50 L 30 30 Z" fill="url(#grad_other)"/></svg>`
        };

        // --- Daily Content Data ---
        const bookQuotes = [
            { title: "Atomic Habits", quote: "You do not rise to the level of your goals. You fall to the level of your systems.", author: "James Clear" },
            { title: "Deep Work", quote: "To produce at your peak level you need to work for extended periods with full concentration on a single task free from distraction.", author: "Cal Newport" },
            { title: "The Power of Habit", quote: "The Golden Rule of Habit Change: You can't extinguish a bad habit, you can only change it.", author: "Charles Duhigg" },
            { title: "Getting Things Done", quote: "Your mind is for having ideas, not holding them.", author: "David Allen" },
            { title: "Mindset", quote: "The view you adopt for yourself profoundly affects the way you lead your life.", author: "Carol S. Dweck" },
            { title: "The 7 Habits of Highly Effective People", quote: "Most of us spend too much time on what is urgent and not enough time on what is important.", author: "Stephen Covey" },
            { title: "Thinking, Fast and Slow", quote: "A reliable way to make people believe in falsehoods is frequent repetition, because familiarity is not easily distinguished from truth.", author: "Daniel Kahneman" },
            { title: "The Miracle Morning", quote: "Your level of success will rarely exceed your level of personal development.", author: "Hal Elrod" },
            { title: "Essentialism", quote: "If you don’t prioritize your life, someone else will.", author: "Greg McKeown" },
            { title: "The One Thing", quote: "What’s the ONE Thing you can do such that by doing it everything else will be easier or unnecessary?", author: "Gary Keller" }
        ];

        const dsaTopics = [
            {
                title: "Binary Search",
                content: "Binary Search is an efficient algorithm for finding an item from a sorted list of items. It works by repeatedly dividing the search interval in half.",
                code: `function binarySearch(arr, target) {
    let left = 0;
    let right = arr.length - 1;
    while (left <= right) {
        let mid = Math.floor((left + right) / 2);
        if (arr[mid] === target) return mid;
        if (arr[mid] < target) left = mid + 1;
        else right = mid - 1;
    }
    return -1;
}`,
                interviewTip: "Always clarify if the input array is sorted and consider edge cases like empty arrays or duplicate elements."
            },
            {
                title: "Linked List Reversal",
                content: "Reversing a singly linked list involves changing the direction of the pointers to make the last node the new head.",
                code: `class ListNode {
    constructor(val) {
        this.val = val;
        this.next = null;
    }
}
function reverseList(head) {
    let prev = null;
    let current = head;
    while (current) {
        let next = current.next;
        current.next = prev;
        prev = current;
        current = next;
    }
    return prev;
}`,
                interviewTip: "Practice iterative and recursive solutions, and be ready to explain space and time complexity (O(n) time, O(1) space for iterative)."
            },
            {
                title: "Depth-First Search (DFS)",
                content: "DFS is a graph traversal algorithm that explores as far as possible along each branch before backtracking.",
                code: `function dfs(graph, start) {
    const visited = new Set();
    function explore(node) {
        visited.add(node);
        console.log(node);
        for (let neighbor of graph[node]) {
            if (!visited.has(neighbor)) explore(neighbor);
        }
    }
    explore(start);
}`,
                interviewTip: "Discuss when to use DFS vs. BFS and how to handle cycles in graphs."
            }
        ];

        const webDevTopics = [
            {
                title: "React useEffect Hook",
                content: "The useEffect hook in React lets you perform side effects in function components, such as fetching data or updating the DOM.",
                code: `import { useEffect, useState } from 'react';
function Example() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        document.title = \`Count: \${count}\`;
        return () => {
            document.title = 'React App';
        };
    }, [count]);
    return <button onClick={() => setCount(count + 1)}>Increment</button>;
}`,
                interviewTip: "Explain the dependency array and cleanup function to avoid memory leaks in interviews."
            },
            {
                title: "CSS Flexbox",
                content: "Flexbox is a CSS layout model that allows elements to align and distribute space within a container efficiently.",
                code: `.container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
}
.item {
    flex: 1;
    min-width: 100px;
}`,
                interviewTip: "Be prepared to explain flex properties like justify-content, align-items, and flex-grow."
            },
            {
                title: "REST API Basics",
                content: "REST APIs allow communication between client and server using standard HTTP methods like GET, POST, PUT, DELETE.",
                code: `fetch('https://api.example.com/data', {
    method: 'GET',
    headers: { 'Content-Type': 'application/json' }
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`,
                interviewTip: "Discuss HTTP status codes and how to handle errors in API calls."
            },
            {
                title: "JavaScript Promises",
                content: "Promises represent the eventual completion (or failure) of an asynchronous operation and its resulting value.",
                code: `function fetchData() {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const data = { id: 1, name: "Sample" };
            if (data) resolve(data);
            else reject("Data not found");
        }, 1000);
    });
}
fetchData().then(data => console.log(data)).catch(err => console.error(err));`,
                interviewTip: "Explain the states of a Promise (pending, fulfilled, rejected) and async/await syntax."
            }
        ];

        const cseTopics = [
            {
                title: "TCP vs UDP",
                content: "TCP is a connection-oriented protocol ensuring reliable data transfer, while UDP is connectionless and faster but less reliable.",
                interviewTip: "Know when to use TCP (e.g., web browsing) vs. UDP (e.g., streaming, gaming)."
            },
            {
                title: "SQL Joins",
                content: "SQL Joins combine rows from two or more tables based on a related column, such as INNER JOIN, LEFT JOIN, etc.",
                code: `SELECT employees.name, departments.department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;`,
                interviewTip: "Be ready to draw a Venn diagram to explain different types of joins."
            },
            {
                title: "Operating System Scheduling",
                content: "CPU scheduling algorithms like Round Robin and Priority Scheduling manage process execution to optimize performance.",
                interviewTip: "Discuss trade-offs between algorithms, such as starvation in priority scheduling."
            }
        ];

        const constellationData = [
            { name: "Orion", description: "Known as the Hunter, Orion is one of the most recognizable constellations, featuring bright stars like Betelgeuse and Rigel." },
            { name: "Lyra", description: "A small constellation containing Vega, one of the brightest stars, often associated with the myth of Orpheus." },
            { name: "Cygnus", description: "The Swan, with its prominent cross shape, includes the star Deneb and is linked to the myth of Orpheus." },
            { name: "Aquila", description: "The Eagle, home to Altair, symbolizes Zeus in Greek mythology and is part of the Summer Triangle." },
            { name: "Perseus", description: "Named after the Greek hero, it contains the famous variable star Algol and the Perseus Cluster." },
            { name: "Andromeda", description: "Named after the princess, it hosts the Andromeda Galaxy, the closest spiral galaxy to the Milky Way." },
            { name: "Cassiopeia", description: "Recognizable by its W shape, it’s named after the queen in Greek mythology and is visible year-round in the north." },
            { name: "Draco", description: "The Dragon, winding around the North Star, was once the pole star in ancient times." },
            { name: "Ursa Major", description: "The Great Bear, containing the Big Dipper, is used for navigation and is one of the largest constellations." },
            { name: "Centaurus", description: "Represents a centaur and includes Alpha Centauri, the closest star system to our Sun." },
            { name: "Scorpius", description: "The Scorpion, with the bright star Antares, is associated with the myth of Orion’s death." },
            { name: "Taurus", description: "The Bull, featuring the Pleiades star cluster and Aldebaran, linked to Zeus’s transformation." },
            { name: "Gemini", description: "The Twins, Castor and Pollux, are prominent in winter skies and linked to Greek mythology." },
            { name: "Leo", description: "The Lion, with Regulus as its brightest star, symbolizes strength and royalty." },
            { name: "Virgo", description: "The Virgin, containing Spica, is one of the largest constellations and linked to harvest myths." },
            { name: "Libra", description: "The Scales, associated with justice, is one of the zodiac constellations and lies between Virgo and Scorpius." },
            { name: "Sagittarius", description: "The Archer, pointing toward the galactic center, features the bright star Nunki." },
            { name: "Capricornus", description: "The Sea Goat, a zodiac constellation, is associated with the god Pan in mythology." },
            { name: "Aquarius", description: "The Water Bearer, linked to the myth of Ganymede, is prominent in autumn skies." },
            { name: "Pisces", description: "The Fish, a zodiac constellation, represents Aphrodite and Eros escaping danger." }
        ];

        const quizData = [
            {
                category: "DSA",
                question: "What is the time complexity of Binary Search?",
                options: ["O(n)", "O(log n)", "O(n log n)", "O(n²)"],
                correct: "O(log n)",
                explanation: "Binary Search divides the search space in half each step, resulting in O(log n) time complexity for a sorted array."
            },
            {
                category: "DSA",
                question: "Which data structure is best for implementing a queue?",
                options: ["Array", "Linked List", "Binary Tree", "Hash Table"],
                correct: "Linked List",
                explanation: "Linked Lists are ideal for queues due to O(1) enqueue and dequeue operations at the ends."
            },
            {
                category: "DSA",
                question: "What is the worst-case time complexity of QuickSort?",
                options: ["O(n)", "O(n log n)", "O(n²)", "O(log n)"],
                correct: "O(n²)",
                explanation: "QuickSort's worst-case occurs with unbalanced partitions (e.g., sorted array), leading to O(n²) complexity."
            },
            {
                category: "Web Dev",
                question: "What does the React `useEffect` hook primarily handle?",
                options: ["State management", "Side effects", "Component rendering", "Event listeners"],
                correct: "Side effects",
                explanation: "The `useEffect` hook is used for side effects like data fetching, subscriptions, or DOM updates."
            },
            {
                category: "Web Dev",
                question: "Which CSS property controls element stacking order?",
                options: ["position", "z-index", "display", "float"],
                correct: "z-index",
                explanation: "The `z-index` property determines the stacking order of positioned elements."
            },
            {
                category: "Web Dev",
                question: "What is the purpose of the `async` keyword in JavaScript?",
                options: ["To define a synchronous function", "To handle errors", "To make a function return a Promise", "To pause execution"],
                correct: "To make a function return a Promise",
                explanation: "The `async` keyword ensures a function returns a Promise and enables `await` usage."
            },
            {
                category: "Web Dev",
                question: "What does CORS stand for?",
                options: ["Cross-Origin Resource Sharing", "Client-Origin Request Security", "Cross-Origin Response System", "Client-Origin Resource Standard"],
                correct: "Cross-Origin Resource Sharing",
                explanation: "CORS is a mechanism that allows restricted resources to be requested from another domain."
            },
            {
                category: "CSE",
                question: "Which protocol is connection-oriented?",
                options: ["UDP", "TCP", "HTTP", "DNS"],
                correct: "TCP",
                explanation: "TCP ensures reliable, ordered data transfer with a three-way handshake, unlike UDP."
            },
            {
                category: "CSE",
                question: "What is virtual memory?",
                options: ["Physical RAM", "Memory on disk used as RAM", "Cache memory", "ROM storage"],
                correct: "Memory on disk used as RAM",
                explanation: "Virtual memory uses disk space to extend RAM, allowing processes to use more memory than physically available."
            },
            {
                category: "CSE",
                question: "What does ACID stand for in databases?",
                options: ["Atomicity, Consistency, Isolation, Durability", "Access, Control, Integration, Data", "Atomicity, Control, Isolation, Data", "Availability, Consistency, Integration, Durability"],
                correct: "Atomicity, Consistency, Isolation, Durability",
                explanation: "ACID properties ensure reliable database transactions."
            }
        ];

        const achievementData = [
            { id: "first_task", name: "First Mission", description: "Complete your first task.", icon: "🚀" },
            { id: "streak_5", name: "Stellar Streak", description: "Achieve a 5-day streak.", icon: "🌟" },
            { id: "focus_hour", name: "Focus Master", description: "Log 1 hour of focus time.", icon: "⏱️" },
            { id: "quiz_ace", name: "Quiz Ace", description: "Answer a quiz question correctly.", icon: "📝" },
            { id: "perfect_day", name: "Perfect Day", description: "Complete all tasks in a day.", icon: "🏅" }
        ];

        const motivationalQuotes = [
            "ReBuild it ..BRICK BY BRICK",
            "Stay focused, the stars are watching!",
            "Every task completed is a step toward mastery.",
            "Discipline turns dreams into reality.",
            "Keep pushing, you're orbiting closer to success!"
        ];

        // --- Core App State ---
        let tasks = [], completionHistory = {}, timeLog = {}, currentStreak = 0, discoveredStreaks = [], achievements = [], userLevel = 1;
        let timerInterval = null, timerSeconds = 0, activeTimerTaskId = null;
        let completionChartInstance = null, categoryChartInstance = null;

        // --- Dynamic Starfield Canvas ---
        const canvas = document.getElementById('starfield-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let rotation = 0;

        function initStarfield() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars = [];
            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: (Math.random() - 0.5) * canvas.width * 2,
                    y: (Math.random() - 0.5) * canvas.height * 2,
                    z: Math.random() * canvas.width,
                    size: Math.random() * 1.5 + 0.5,
                });
            }
        }

        function animateStarfield() {
            rotation += 0.00005;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(rotation);
            stars.forEach(star => {
                let k = 128 / star.z;
                let px = star.x * k;
                let py = star.y * k;
                let size = (1 - star.z / canvas.width) * star.size;
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 255, 255, ${1 - star.z / canvas.width})`;
                ctx.arc(px, py, size, 0, Math.PI * 2);
                ctx.fill();
                star.z -= 0.2;
                if (star.z <= 0) star.z = canvas.width;
            });
            ctx.restore();
            requestAnimationFrame(animateStarfield);
        }

        // Initialize starfield on load
        window.addEventListener('load', () => {
            initStarfield();
            animateStarfield();
            document.getElementById('welcomeOverlay').classList.add('hidden');
        });

        window.addEventListener('resize', initStarfield);


        // --- Core App Logic ---

// Utility to get the day of the year
function getDayOfYear() {
    return Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
}

// Add a new task
function addTask() {
    const taskInput = document.getElementById('taskInput');
    const categorySelect = document.getElementById('categorySelect');
    const prioritySelect = document.getElementById('prioritySelect');
    if (!taskInput.value.trim()) {
        showNotification('Please enter a mission name.');
        return;
    }
    showLoading();
    const task = {
        id: Date.now(),
        name: taskInput.value.trim(),
        category: categorySelect.value,
        priority: prioritySelect.value,
        completed: false,
        timeSpent: 0,
        createdAt: new Date().toDateString()
    };
    tasks.push(task);
    taskInput.value = '';
    renderTasks();
    updateStats();
    saveData();
    if (!achievements.some(a => a.id === 'first_task')) unlockAchievement('first_task');
    showNotification(`Mission "${task.name}" added!`);
    hideLoading();
}

// Complete or uncomplete a task
function completeTask(taskId) {
    showLoading();
    const task = tasks.find(t => t.id === taskId);
    if (task) {
        task.completed = !task.completed;
        const today = new Date().toDateString();
        const todayTasks = tasks.filter(t => t.createdAt === today);
        const allComplete = todayTasks.every(t => t.completed);
        if (todayTasks.some(t => t.completed)) {
            completionHistory[today] = { completed: true, perfect: allComplete };
            if (allComplete && !achievements.some(a => a.id === 'perfect_day')) {
                unlockAchievement('perfect_day');
            }
        } else {
            delete completionHistory[today];
        }
        renderTasks();
        updateStats();
        renderCalendar();
        saveData();
        showNotification(task.completed ? `Mission "${task.name}" completed!` : `Mission "${task.name}" reopened.`);
    }
    hideLoading();
}

// Delete a task
function deleteTask(taskId) {
    showLoading();
    const task = tasks.find(t => t.id === taskId);
    tasks = tasks.filter(t => t.id !== taskId);
    renderTasks();
    updateStats();
    renderCalendar();
    saveData();
    showNotification(`Mission "${task.name}" deleted.`);
    hideLoading();
}

// Render tasks for the current day
function renderTasks() {
    const taskList = document.getElementById('taskList');
    const todayTasks = tasks.filter(t => t.createdAt === new Date().toDateString());
    todayTasks.sort((a, b) => {
        const priorityOrder = { high: 1, medium: 2, low: 3 };
        return priorityOrder[a.priority] - priorityOrder[b.priority];
    });
    taskList.innerHTML = todayTasks.map(task => `
        <div class="task-item ${task.completed ? 'task-completed completed' : 'added'}">
            <div class="task-info">
                ${planetIcons[task.category] || planetIcons['other']}
                <span class="task-name">${task.name}</span>
                <span class="priority-label priority-${task.priority}">${task.priority}</span>
            </div>
            <div class="task-actions">
                <button class="btn-small btn-complete" onclick="startTimer(${task.id})">Engage</button>
                <button class="btn-small btn-complete" onclick="completeTask(${task.id})">${task.completed ? 'Done' : 'Complete'}</button>
                <button class="btn-small btn-delete" onclick="deleteTask(${task.id})">Delete</button>
            </div>
        </div>`).join('');
}

// Update stats (total tasks, completed today, streak, completion rate)
function updateStats() {
    const today = new Date().toDateString();
    const todayTasks = tasks.filter(t => t.createdAt === today);
    const completedToday = todayTasks.filter(t => t.completed).length;
    const totalTasksCount = tasks.length;
    const completionRate = totalTasksCount ? Math.round((tasks.filter(t => t.completed).length / totalTasksCount) * 100) : 0;

    let streak = 0;
    let date = new Date();
    while (completionHistory[date.toDateString()]?.completed) {
        streak++;
        date.setDate(date.getDate() - 1);
    }
    currentStreak = streak;
    if (streak >= 5 && !achievements.some(a => a.id === 'streak_5')) {
        unlockAchievement('streak_5');
    }
    if (streak > 0 && !discoveredStreaks.includes(streak)) {
        discoveredStreaks.push(streak);
        showNotification(`🌌 Streak Milestone: ${streak} days! Earned "${constellationData[streak % constellationData.length].name}" badge!`);
    }

    const totalTime = Object.values(timeLog).reduce((sum, cat) => sum + cat, 0);
    if (totalTime >= 3600 && !achievements.some(a => a.id === 'focus_hour')) {
        unlockAchievement('focus_hour');
    }

    userLevel = Math.floor(tasks.filter(t => t.completed).length / 5) + 1;

    document.getElementById('totalTasks').textContent = totalTasksCount;
    document.getElementById('completedTasks').textContent = completedToday;
    document.getElementById('currentStreak').textContent = currentStreak;
    document.getElementById('completionRate').textContent = `${completionRate}%`;
    document.getElementById('streakDisplay').textContent = currentStreak;
    document.getElementById('fireIcon').classList.toggle('active', currentStreak > 0);
    document.getElementById('progressFill').style.width = `${completionRate}%`;
    document.getElementById('levelDisplay').textContent = `Level: ${userLevel}`;

    renderTimeAnalysis();
    updateMissionInsight();
}

// Render calendar with completion history
function renderCalendar() {
    const calendar = document.getElementById('calendar');
    const svg = document.getElementById('constellation-svg');
    calendar.innerHTML = '';
    svg.innerHTML = '';
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    days.forEach(day => {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day header';
        dayEl.textContent = day;
        calendar.appendChild(dayEl);
    });

    const today = new Date();
    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1).getDay();
    const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();

    for (let i = 0; i < firstDayOfMonth; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day inactive';
        calendar.appendChild(emptyDay);
    }

    const activeDays = [];
    for (let i = 1; i <= daysInMonth; i++) {
        const date = new Date(today.getFullYear(), today.getMonth(), i);
        const dateString = date.toDateString();
        const dayEl = document.createElement('div');
        dayEl.className = `calendar-day ${completionHistory[dateString]?.completed ? 'active' : 'inactive'}`;
        if (completionHistory[dateString]?.perfect) dayEl.classList.add('perfect-day');
        dayEl.innerHTML = `<span class="day-number">${i}</span>`;
        if (completionHistory[dateString]?.completed) {
            const star = document.createElement('div');
            star.className = 'day-star';
            dayEl.appendChild(star);
            activeDays.push({ x: (calendar.children.length % 7) * 50 + 25, y: Math.floor(calendar.children.length / 7) * 50 + 25 });
        }
        calendar.appendChild(dayEl);
    }

    if (activeDays.length > 1) {
        for (let i = 1; i < activeDays.length; i++) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('class', 'constellation-line');
            line.setAttribute('x1', activeDays[i - 1].x);
            line.setAttribute('y1', activeDays[i - 1].y);
            line.setAttribute('x2', activeDays[i].x);
            line.setAttribute('y2', activeDays[i].y);
            svg.appendChild(line);
        }
    }
}

// Render time analysis for focus distribution
function renderTimeAnalysis() {
    const timeAnalysis = document.getElementById('timeAnalysis');
    const categories = [ 'DSA', 'Development', 'project', 'Other',];
    const totalTime = Object.values(timeLog).reduce((sum, cat) => sum + cat, 0) || 1;
    timeAnalysis.innerHTML = categories.map(category => {
        const time = timeLog[category] || 0;
        const percentage = ((time / totalTime) * 100).toFixed(1);
        return `
            <div class="category-time-bar">
                <div class="category-time-label">${category}</div>
                <div class="category-time-progress">
                    <div class="category-time-fill" style="width: ${percentage}%"></div>
                </div>
                <div class="category-time-value">${Math.floor(time / 60)} min</div>
            </div>`;
    }).join('');
}

// Update mission insights
function updateMissionInsight() {
    const insightEl = document.getElementById('missionInsight');
    const todayTasks = tasks.filter(t => t.createdAt === new Date().toDateString());
    let insight = "No missions yet today. Start by adding a new mission!";
    if (todayTasks.length > 0) {
        const completed = todayTasks.filter(t => t.completed).length;
        const highPriority = todayTasks.filter(t => t.priority === 'high').length;
        if (completed === todayTasks.length && todayTasks.length > 0) {
            insight = "All missions completed today! You're a productivity superstar!";
        } else if (highPriority > 0) {
            insight = `You have ${highPriority} high-priority mission${highPriority > 1 ? 's' : ''} left. Tackle them first!`;
        } else {
            insight = `You've completed ${completed}/${todayTasks.length} missions today. Keep pushing forward!`;
        }
    }
    insightEl.classList.add('fade-out');
    setTimeout(() => {
        insightEl.textContent = insight;
        insightEl.classList.remove('fade-out');
    }, 500);
}

// Timer logic for focus mode
function startTimer(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (!task) return;
    activeTimerTaskId = taskId;
    timerSeconds = task.timeSpent;
    document.getElementById('timerMissionName').textContent = task.name;
    document.getElementById('focus-timer-modal').classList.remove('hidden');
    updateTimerDisplay();
    const timerControlBtn = document.getElementById('timerControlBtn');
    timerControlBtn.textContent = 'Pause';
    timerControlBtn.onclick = toggleTimer;
    document.getElementById('stopTimerBtn').onclick = stopTimer;
    if (!timerInterval) {
        timerInterval = setInterval(() => {
            timerSeconds++;
            updateTimerDisplay();
            task.timeSpent = timerSeconds;
            timeLog[task.category] = (timeLog[task.category] || 0) + 1;
            saveData();
            if (timerSeconds >= 3600 && !achievements.some(a => a.id === 'focus_hour')) {
                unlockAchievement('focus_hour');
            }
        }, 1000);
    }
}

function toggleTimer() {
    const timerControlBtn = document.getElementById('timerControlBtn');
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
        timerControlBtn.textContent = 'Resume';
    } else {
        timerInterval = setInterval(() => {
            timerSeconds++;
            updateTimerDisplay();
            const task = tasks.find(t => t.id === activeTimerTaskId);
            if (task) {
                task.timeSpent = timerSeconds;
                timeLog[task.category] = (timeLog[task.category] || 0) + 1;
                saveData();
                if (timerSeconds >= 3600 && !achievements.some(a => a.id === 'focus_hour')) {
                    unlockAchievement('focus_hour');
                }
            }
        }, 1000);
        timerControlBtn.textContent = 'Pause';
    }
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    const task = tasks.find(t => t.id === activeTimerTaskId);
    if (task) {
        task.timeSpent = timerSeconds;
        timeLog[task.category] = (timeLog[task.category] || 0) + timerSeconds;
        saveData();
        showNotification(`Focus time logged for "${task.name}": ${Math.floor(timerSeconds / 60)} minutes.`);
    }
    activeTimerTaskId = null;
    timerSeconds = 0;
    document.getElementById('focus-timer-modal').classList.add('hidden');
    renderTimeAnalysis();
}

function updateTimerDisplay() {
    const minutes = Math.floor(timerSeconds / 60);
    const seconds = timerSeconds % 60;
    document.getElementById('timerText').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    const totalDuration = 25 * 60; // 25-minute Pomodoro session
    const progress = timerSeconds / totalDuration;
    const dashOffset = 339.292 * (1 - Math.min(progress, 1));
    document.getElementById('timerRing').setAttribute('stroke-dashoffset', dashOffset);
}

// Save data to localStorage
function saveData() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
    localStorage.setItem('completionHistory', JSON.stringify(completionHistory));
    localStorage.setItem('timeLog', JSON.stringify(timeLog));
    localStorage.setItem('achievements', JSON.stringify(achievements));
    localStorage.setItem('discoveredStreaks', JSON.stringify(discoveredStreaks));
    localStorage.setItem('userLevel', userLevel);
}

// Load data from localStorage
function loadData() {
    tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
    completionHistory = JSON.parse(localStorage.getItem('completionHistory') || '{}');
    timeLog = JSON.parse(localStorage.getItem('timeLog') || '{}');
    achievements = JSON.parse(localStorage.getItem('achievements') || '[]');
    discoveredStreaks = JSON.parse(localStorage.getItem('discoveredStreaks') || '[]');
    userLevel = parseInt(localStorage.getItem('userLevel') || '1');
    renderTasks();
    updateStats();
    renderCalendar();
}

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
    loadData();
});



// --- Notification and Loading Utilities ---
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.classList.add('show'), 10);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 500);
    }, 3000);
}

function showLoading() {
    document.getElementById('loadingSpinner').classList.add('show');
}

function hideLoading() {
    setTimeout(() => document.getElementById('loadingSpinner').classList.remove('show'), 500);
}

// --- Achievement Logic ---
function unlockAchievement(achievementId) {
    const achievement = achievementData.find(a => a.id === achievementId);
    if (achievement && !achievements.some(a => a.id === achievementId)) {
        achievements.push(achievement);
        saveData();
        showNotification(`Achievement Unlocked: ${achievement.name}!`);
        renderAchievements();
    }
}

function renderAchievements() {
    const achievementsModalBody = document.getElementById('achievementsModalBody');
    achievementsModalBody.innerHTML = achievements.length > 0 ? achievements.map(a => `
        <div class="achievement-item">
            <span class="achievement-icon">${a.icon}</span>
            <div>
                <div class="achievement-name">${a.name}</div>
                <div class="achievement-desc">${a.description}</div>
            </div>
        </div>
    `).join('') : '<p>No achievements unlocked yet. Keep pushing!</p>';
}

// --- Modal Handlers ---
function showModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function hideModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

// Lessons Modal with Quiz
function renderLessonsModal() {
    const category = ['DSA', 'Web Dev', 'CSE'][Math.floor(Math.random() * 3)];
    const topics = { 'DSA': dsaTopics, 'Web Dev': webDevTopics, 'CSE': cseTopics }[category];
    const topic = topics[Math.floor(Math.random() * topics.length)];
    const modalBody = document.getElementById('lessonsModalBody');
    modalBody.innerHTML = `
        <div class="lesson-category">
            <h3>${category}: ${topic.title}</h3>
            <p>${topic.content}</p>
            ${topic.code ? `<pre class="code-snippet"><code class="${category === 'Web Dev' && topic.title.includes('CSS') ? 'language-css' : 'language-javascript'}">${topic.code}</code></pre>` : ''}
            <p><strong>Interview Tip:</strong> ${topic.interviewTip}</p>
            <a href="https://en.wikipedia.org/wiki/${topic.title.replace(/ /g, '_')}" target="_blank" class="learn-more-link">Learn More</a>
        </div>
    `;
    Prism.highlightAll();
    renderQuiz(category);
    showModal('lessonsModal');
}

// Quiz Logic
function renderQuiz(category) {
    const quizContainer = document.getElementById('quizContainer');
    const quiz = quizData.filter(q => q.category === category)[Math.floor(Math.random() * quizData.filter(q => q.category === category).length)];
    quizContainer.innerHTML = `
        <div class="quiz-question">${quiz.question}</div>
        <div class="quiz-options">
            ${quiz.options.map((option, i) => `<div class="quiz-option" data-index="${i}">${option}</div>`).join('')}
        </div>
        <div class="quiz-feedback" id="quizFeedback"></div>
    `;
    document.querySelectorAll('.quiz-option').forEach(option => {
        option.addEventListener('click', () => handleQuizAnswer(quiz, option.dataset.index));
    });
}

function handleQuizAnswer(quiz, selectedIndex) {
    const feedbackEl = document.getElementById('quizFeedback');
    const options = document.querySelectorAll('.quiz-option');
    const correctIndex = quiz.options.indexOf(quiz.correct);
    options.forEach((opt, i) => {
        opt.classList.add(i == correctIndex ? 'correct' : 'incorrect');
        opt.style.pointerEvents = 'none';
    });
    feedbackEl.textContent = selectedIndex == correctIndex ? 'Correct! Great job!' : `Incorrect. ${quiz.explanation}`;
    if (selectedIndex == correctIndex && !achievements.some(a => a.id === 'quiz_ace')) {
        unlockAchievement('quiz_ace');
    }
    setTimeout(() => {
        renderLessonsModal();
    }, 2000);
}

// Book Quote Modal
function renderBookQuoteModal() {
    const quote = bookQuotes[Math.floor(Math.random() * bookQuotes.length)];
    document.getElementById('bookQuoteModalBody').innerHTML = `
        <div class="lesson-category">
            <h3>${quote.title}</h3>
            <p>"${quote.quote}"</p>
            <p class="source">— ${quote.author}</p>
        </div>
    `;
    showModal('bookQuoteModal');
}

// Constellation Modal
function renderConstellationModal() {
    const streakIndex = Math.min(currentStreak, constellationData.length - 1);
    const constellation = constellationData[streakIndex];
    document.getElementById('constellationModalBody').innerHTML = `
        <div class="lesson-category">
            <h3>${constellation.name}</h3>
            <p>${constellation.description}</p>
            <p class="source">Current Streak: ${currentStreak} days</p>
        </div>
    `;
    showModal('constellationModal');
}

// Weekly Report Modal
function renderWeeklyReportModal() {
    const today = new Date();
    const weekStart = new Date(today);
    weekStart.setDate(today.getDate() - today.getDay());
    const weekTasks = tasks.filter(t => new Date(t.createdAt) >= weekStart);
    const completedTasks = weekTasks.filter(t => t.completed).length;
    const totalTime = Object.values(timeLog).reduce((sum, cat) => sum + cat, 0);
    const categoryBreakdown = Object.entries(timeLog).map(([cat, time]) => `${cat}: ${Math.floor(time / 60)} min`).join(', ');
    const report = `
        <h3>Weekly Mission Report</h3>
        <p><strong>Tasks Logged:</strong> ${weekTasks.length}</p>
        <p><strong>Tasks Completed:</strong> ${completedTasks}</p>
        <p><strong>Total Focus Time:</strong> ${Math.floor(totalTime / 60)} minutes</p>
        <p><strong>Category Breakdown:</strong> ${categoryBreakdown || 'None'}</p>
        <p><strong>Insight:</strong> ${completedTasks === weekTasks.length && weekTasks.length > 0 ? 'Perfect week! All missions accomplished!' : 'Keep pushing to complete all missions!'}</p>
    `;
    document.getElementById('weeklyReportBody').innerHTML = report;
    showModal('weeklyReportModal');
}

// Analytics Dashboard
function renderAnalyticsDashboard() {
    if (completionChartInstance) completionChartInstance.destroy();
    if (categoryChartInstance) categoryChartInstance.destroy();

    const completionData = [];
    const labels = [];
    const today = new Date();
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateString = date.toDateString();
        const dailyTasks = tasks.filter(t => t.createdAt === dateString);
        const completed = dailyTasks.filter(t => t.completed).length;
        const total = dailyTasks.length || 1;
        completionData.push((completed / total) * 100);
        labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
    }

    const ctx1 = document.getElementById('completionChart').getContext('2d');
    completionChartInstance = new Chart(ctx1, {
        type: 'line',
        data: {
            labels,
            datasets: [{
                label: 'Completion Rate (%)',
                data: completionData,
                borderColor: 'rgba(100, 255, 218, 0.8)',
                backgroundColor: 'rgba(100, 255, 218, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true, max: 100 } },
            plugins: { legend: { labels: { color: 'var(--text-color)' } } }
        }
    });

    const categoryData = Object.entries(timeLog).map(([cat, time]) => Math.floor(time / 60));
    const categoryLabels = Object.keys(timeLog);
    const ctx2 = document.getElementById('categoryChart').getContext('2d');
    categoryChartInstance = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: categoryLabels,
            datasets: [{
                label: 'Focus Time (min)',
                data: categoryData,
                backgroundColor: 'rgba(100, 255, 218, 0.5)',
                borderColor: 'rgba(100, 255, 218, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { labels: { color: 'var(--text-color)' } } }
        }
    });

    showModal('analyticsModal');
}

// Theme Toggle
function toggleTheme() {
    const body = document.body;
    const isDark = body.dataset.theme === 'dark';
    body.dataset.theme = isDark ? 'light' : 'dark';
    document.getElementById('themeToggle').textContent = isDark ? '☀️' : '🌙';
}

// Motivational Quote Rotation
function rotateMotivationalQuote() {
    const quoteEl = document.getElementById('motivationalQuote');
    quoteEl.classList.add('fade');
    setTimeout(() => {
        quoteEl.textContent = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
        quoteEl.classList.remove('fade');
    }, 500);
}

// Event Listeners
document.getElementById('themeToggle').addEventListener('click', toggleTheme);
document.getElementById('lessonsTrigger').addEventListener('click', renderLessonsModal);
document.getElementById('bookQuoteTrigger').addEventListener('click', renderBookQuoteModal);
document.getElementById('constellationTrigger').addEventListener('click', renderConstellationModal);
document.getElementById('achievementsTrigger').addEventListener('click', () => {
    renderAchievements();
    showModal('achievementsModal');
});
document.getElementById('weeklyReportTrigger').addEventListener('click', renderWeeklyReportModal);
document.getElementById('analyticsTrigger').addEventListener('click', renderAnalyticsDashboard);
document.getElementById('closeLessonsModal').addEventListener('click', () => hideModal('lessonsModal'));
document.getElementById('closeBookQuoteModal').addEventListener('click', () => hideModal('bookQuoteModal'));
document.getElementById('closeConstellationModal').addEventListener('click', () => hideModal('constellationModal'));
document.getElementById('closeTimerModal').addEventListener('click', () => {
    stopTimer();
    hideModal('focus-timer-modal');
});
document.getElementById('closeWeeklyReportModal').addEventListener('click', () => hideModal('weeklyReportModal'));
document.getElementById('closeAnalyticsModal').addEventListener('click', () => hideModal('analyticsModal'));
document.getElementById('closeAchievementsModal').addEventListener('click', () => hideModal('achievementsModal'));

// Periodic Updates
setInterval(rotateMotivationalQuote, 10000);
setInterval(() => {
    if (new Date().getHours() === 0 && new Date().getMinutes() === 0) {
        renderTasks();
        updateStats();
        renderCalendar();
    }
}, 60000);

// Initialize Achievements on Load
document.addEventListener('DOMContentLoaded', () => {
    renderAchievements();
});
    </script>
</body>
</html>